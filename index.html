<!DOCTYPE html>
<html>
  <!-- Import A-Frame and AR.js libraries -->
  <script src="AR.js/1.3.0/aframe.min.js"></script>
  <!-- Import AR.js version that supports marker + location based AR -->
  <script src="AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    /* Style for the upload section */
    #uploadSection{
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1;
      background: white;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
  <body style="margin: 0px; overflow: hidden;">
    <!-- Upload section for model file and scale input -->
    <div id="uploadSection">
      <input type="file" id="fileInput" accept=".gltf,.glb"/> 
      <input type="number" id="scaleInput" placeholder="Scale (e.g., 3.0)" step="0.1" value="1"/>
      <button id="uploadButton">Upload Model</button>
    </div>
    
    <!-- AR scene setup -->
    <a-scene id="arScene" embedded arjs style="display: none;">
      <!-- Marker where the model will appear, preset to "hiro" marker -->
      <a-marker preset="hiro">
        <a-entity
          id="modelEntity"
          position="0 0 0"
          scale="1 1 1"
          gltf-model="human_brain/scene.gltf"
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Reference to the upload button, file input, model entity, and AR scene
      const uploadButton = document.getElementById('uploadButton');
      const fileInput = document.getElementById('fileInput');
      const modelEntity = document.getElementById('modelEntity');
      const arScene = document.getElementById('arScene');
      const scaleInput = document.getElementById('scaleInput');

      // Event listener for the "Upload Model" button
      uploadButton.addEventListener('click', () => {
        const file = fileInput.files[0]; // Get the uploaded file
        if (file) {
          // Check if the uploaded file is a valid GLTF or GLB model
          if (!file.name.endsWith('.gltf') && !file.name.endsWith('.glb')) {
            alert('Please upload a valid GLTF or GLB file.');
            return;
          }

          // Create a URL for the uploaded file so it can be used in the scene
          const blobUrl = URL.createObjectURL(file);
          modelEntity.setAttribute('gltf-model', blobUrl);

          // Get the scale value from the input field and apply it to the model
          const scaleValue = parseFloat(scaleInput.value) || 1; // Default scale is 1 if input is invalid
          modelEntity.setAttribute('scale', `${scaleValue} ${scaleValue} ${scaleValue}`);

          // Display the AR scene (was hidden by default)
          arScene.style.display = 'block';
        } else {
          // Alert the user if no file was selected
          alert('Please select a GLTF or GLB file first.');
        }
      });
    </script>
  </body>
</html>
